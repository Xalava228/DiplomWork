# Решение проблем с Telegram уведомлениями

## Сообщения не приходят в Telegram

### 1. Проверьте настройки в .env файле

Убедитесь что в файле `.env` правильно указаны:
```env
TELEGRAM_BOT_TOKEN=ваш_токен
TELEGRAM_CHAT_ID=ваш_chat_id
```

**Важно:**
- Нет пробелов в начале/конце значений
- Нет кавычек вокруг значений
- Токен и Chat ID скопированы полностью

### 2. Перезапустите сервер

После изменения `.env` файла **обязательно перезапустите сервер**:
- Остановите сервер (Ctrl+C)
- Запустите снова: `node server.js` или `npm start`

### 3. Проверьте логи сервера

При запуске сервера вы должны увидеть:
```
✅ Telegram настроен
   Bot Token: 1234567890...
   Chat ID: 123456789
```

Если видите `⚠️ Telegram не настроен` - проверьте `.env` файл.

### 4. Напишите боту первым!

**Очень важно:** Вы должны **написать боту первым сообщение** (например "Привет"), иначе бот не сможет вам писать!

1. Найдите вашего бота в Telegram (по username который вы указали)
2. Нажмите "Start" или напишите любое сообщение
3. Только после этого бот сможет отправлять вам сообщения

### 5. Проверьте токен бота

1. Откройте Telegram
2. Найдите @BotFather
3. Отправьте `/mybots`
4. Выберите вашего бота
5. Нажмите "API Token"
6. Скопируйте токен и сравните с тем что в `.env`

### 6. Проверьте Chat ID

**Способ 1: Через @userinfobot**
1. Найдите @userinfobot в Telegram
2. Отправьте `/start`
3. Он покажет ваш Chat ID
4. Убедитесь что он совпадает с `.env`

**Способ 2: Через API**
1. Откройте в браузере: `https://api.telegram.org/botВАШ_ТОКЕН/getUpdates`
2. Замените `ВАШ_ТОКЕН` на токен из `.env`
3. Найдите `"chat":{"id":123456789}` - это ваш Chat ID

### 7. Протестируйте отправку

1. Зайдите в админку: `/admin`
2. Войдите с паролем
3. Откройте в браузере: `http://localhost:3000/api/test-telegram`
4. Должно прийти тестовое сообщение в Telegram

### 8. Частые ошибки

**Ошибка: "chat not found"**
- ✅ Решение: Напишите боту первым сообщение!

**Ошибка: "Unauthorized"**
- ✅ Решение: Проверьте правильность TELEGRAM_BOT_TOKEN

**Ошибка: "Bad Request"**
- ✅ Решение: Проверьте правильность TELEGRAM_CHAT_ID

**Ошибка: "Forbidden"**
- ✅ Решение: Бот заблокирован или удалён. Создайте нового через @BotFather

### 9. Проверьте что сервер получает заявки

1. Откройте консоль где запущен сервер
2. Отправьте тестовую заявку через форму на сайте
3. В консоли должны появиться логи:
   - `✅ Telegram сообщение отправлено успешно` - если всё ОК
   - `❌ Ошибка отправки в Telegram: ...` - если есть проблема

### 10. Проверьте интернет соединение

Убедитесь что сервер имеет доступ к интернету и может отправлять запросы на `api.telegram.org`.

---

## Если ничего не помогло

1. Проверьте что бот не удалён (через `/mybots` в @BotFather)
2. Создайте нового бота и используйте новый токен
3. Убедитесь что Chat ID правильный (может быть отрицательным для групп)
4. Проверьте что в `.env` нет лишних пробелов или символов

---

## Быстрая проверка

Выполните эти команды в терминале (замените значения):

```bash
# Проверка что переменные загружены
node -e "require('dotenv').config(); console.log('Token:', process.env.TELEGRAM_BOT_TOKEN ? 'Есть' : 'НЕТ'); console.log('Chat ID:', process.env.TELEGRAM_CHAT_ID ? 'Есть' : 'НЕТ');"

# Тест отправки (замените значения)
curl -X POST "https://api.telegram.org/botВАШ_ТОКЕН/sendMessage" \
  -H "Content-Type: application/json" \
  -d '{"chat_id":"ВАШ_CHAT_ID","text":"Тест"}'
```

Если последняя команда вернёт `{"ok":true}` - значит настройки правильные, проблема в коде сервера.


